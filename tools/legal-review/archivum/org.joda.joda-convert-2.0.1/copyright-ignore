Copied from Guava and altered. Original copyright:
